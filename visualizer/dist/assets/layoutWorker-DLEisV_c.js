(function(){"use strict";function jt(t){const n=+this._x.call(null,t);return vt(this.cover(n),n,t)}function vt(t,n,i){if(isNaN(n))return t;var e,r=t._root,s={data:i},o=t._x0,a=t._x1,h,l,u,c,v;if(!r)return t._root=s,t;for(;r.length;)if((u=n>=(h=(o+a)/2))?o=h:a=h,e=r,!(r=r[c=+u]))return e[c]=s,t;if(l=+t._x.call(null,r.data),n===l)return s.next=r,e?e[c]=s:t._root=s,t;do e=e?e[c]=new Array(2):t._root=new Array(2),(u=n>=(h=(o+a)/2))?o=h:a=h;while((c=+u)==(v=+(l>=h)));return e[v]=r,e[c]=s,t}function Et(t){Array.isArray(t)||(t=Array.from(t));const n=t.length,i=new Float64Array(n);let e=1/0,r=-1/0;for(let s=0,o;s<n;++s)isNaN(o=+this._x.call(null,t[s]))||(i[s]=o,o<e&&(e=o),o>r&&(r=o));if(e>r)return this;this.cover(e).cover(r);for(let s=0;s<n;++s)vt(this,i[s],t[s]);return this}function Ft(t){if(isNaN(t=+t))return this;var n=this._x0,i=this._x1;if(isNaN(n))i=(n=Math.floor(t))+1;else{for(var e=i-n||1,r=this._root,s,o;n>t||t>=i;)switch(o=+(t<n),s=new Array(2),s[o]=r,r=s,e*=2,o){case 0:i=n+e;break;case 1:n=i-e;break}this._root&&this._root.length&&(this._root=r)}return this._x0=n,this._x1=i,this}function St(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function Tt(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function R(t,n,i){this.node=t,this.x0=n,this.x1=i}function Ot(t,n){var i,e=this._x0,r,s,o=this._x1,a=[],h=this._root,l,u;for(h&&a.push(new R(h,e,o)),n==null?n=1/0:(e=t-n,o=t+n);l=a.pop();)if(!(!(h=l.node)||(r=l.x0)>o||(s=l.x1)<e))if(h.length){var c=(r+s)/2;a.push(new R(h[1],c,s),new R(h[0],r,c)),(u=+(t>=c))&&(l=a[a.length-1],a[a.length-1]=a[a.length-1-u],a[a.length-1-u]=l)}else{var v=Math.abs(t-+this._x.call(null,h.data));v<n&&(n=v,e=t-v,o=t+v,i=h.data)}return i}function Xt(t){if(isNaN(h=+this._x.call(null,t)))return this;var n,i=this._root,e,r,s,o=this._x0,a=this._x1,h,l,u,c,v;if(!i)return this;if(i.length)for(;;){if((u=h>=(l=(o+a)/2))?o=l:a=l,n=i,!(i=i[c=+u]))return this;if(!i.length)break;n[c+1&1]&&(e=n,v=c)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[c]=s:delete n[c],(i=n[0]||n[1])&&i===(n[1]||n[0])&&!i.length&&(e?e[v]=i:this._root=i),this):(this._root=s,this)}function Rt(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function Yt(){return this._root}function Zt(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function Bt(t){var n=[],i,e=this._root,r,s,o;for(e&&n.push(new R(e,this._x0,this._x1));i=n.pop();)if(!t(e=i.node,s=i.x0,o=i.x1)&&e.length){var a=(s+o)/2;(r=e[1])&&n.push(new R(r,a,o)),(r=e[0])&&n.push(new R(r,s,a))}return this}function Ct(t){var n=[],i=[],e;for(this._root&&n.push(new R(this._root,this._x0,this._x1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.x1,h=(o+a)/2;(s=r[0])&&n.push(new R(s,o,h)),(s=r[1])&&n.push(new R(s,h,a))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.x1);return this}function Ht(t){return t[0]}function Lt(t){return arguments.length?(this._x=t,this):this._x}function nt(t,n){var i=new it(n??Ht,NaN,NaN);return t==null?i:i.addAll(t)}function it(t,n,i){this._x=t,this._x0=n,this._x1=i,this._root=void 0}function yt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var S=nt.prototype=it.prototype;S.copy=function(){var t=new it(this._x,this._x0,this._x1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=yt(n),t;for(i=[{source:n,target:t._root=new Array(2)}];n=i.pop();)for(var r=0;r<2;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(2)}):n.target[r]=yt(e));return t},S.add=jt,S.addAll=Et,S.cover=Ft,S.data=St,S.extent=Tt,S.find=Ot,S.remove=Xt,S.removeAll=Rt,S.root=Yt,S.size=Zt,S.visit=Bt,S.visitAfter=Ct,S.x=Lt;function Pt(t){const n=+this._x.call(null,t),i=+this._y.call(null,t);return xt(this.cover(n,i),n,i,t)}function xt(t,n,i,e){if(isNaN(n)||isNaN(i))return t;var r,s=t._root,o={data:e},a=t._x0,h=t._y0,l=t._x1,u=t._y1,c,v,y,_,d,g,f,p;if(!s)return t._root=o,t;for(;s.length;)if((d=n>=(c=(a+l)/2))?a=c:l=c,(g=i>=(v=(h+u)/2))?h=v:u=v,r=s,!(s=s[f=g<<1|d]))return r[f]=o,t;if(y=+t._x.call(null,s.data),_=+t._y.call(null,s.data),n===y&&i===_)return o.next=s,r?r[f]=o:t._root=o,t;do r=r?r[f]=new Array(4):t._root=new Array(4),(d=n>=(c=(a+l)/2))?a=c:l=c,(g=i>=(v=(h+u)/2))?h=v:u=v;while((f=g<<1|d)===(p=(_>=v)<<1|y>=c));return r[p]=s,r[f]=o,t}function Qt(t){var n,i,e=t.length,r,s,o=new Array(e),a=new Array(e),h=1/0,l=1/0,u=-1/0,c=-1/0;for(i=0;i<e;++i)isNaN(r=+this._x.call(null,n=t[i]))||isNaN(s=+this._y.call(null,n))||(o[i]=r,a[i]=s,r<h&&(h=r),r>u&&(u=r),s<l&&(l=s),s>c&&(c=s));if(h>u||l>c)return this;for(this.cover(h,l).cover(u,c),i=0;i<e;++i)xt(this,o[i],a[i],t[i]);return this}function Wt(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var i=this._x0,e=this._y0,r=this._x1,s=this._y1;if(isNaN(i))r=(i=Math.floor(t))+1,s=(e=Math.floor(n))+1;else{for(var o=r-i||1,a=this._root,h,l;i>t||t>=r||e>n||n>=s;)switch(l=(n<e)<<1|t<i,h=new Array(4),h[l]=a,a=h,o*=2,l){case 0:r=i+o,s=e+o;break;case 1:i=r-o,s=e+o;break;case 2:r=i+o,e=s-o;break;case 3:i=r-o,e=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=i,this._y0=e,this._x1=r,this._y1=s,this}function Gt(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function Jt(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function D(t,n,i,e,r){this.node=t,this.x0=n,this.y0=i,this.x1=e,this.y1=r}function Kt(t,n,i){var e,r=this._x0,s=this._y0,o,a,h,l,u=this._x1,c=this._y1,v=[],y=this._root,_,d;for(y&&v.push(new D(y,r,s,u,c)),i==null?i=1/0:(r=t-i,s=n-i,u=t+i,c=n+i,i*=i);_=v.pop();)if(!(!(y=_.node)||(o=_.x0)>u||(a=_.y0)>c||(h=_.x1)<r||(l=_.y1)<s))if(y.length){var g=(o+h)/2,f=(a+l)/2;v.push(new D(y[3],g,f,h,l),new D(y[2],o,f,g,l),new D(y[1],g,a,h,f),new D(y[0],o,a,g,f)),(d=(n>=f)<<1|t>=g)&&(_=v[v.length-1],v[v.length-1]=v[v.length-1-d],v[v.length-1-d]=_)}else{var p=t-+this._x.call(null,y.data),w=n-+this._y.call(null,y.data),z=p*p+w*w;if(z<i){var x=Math.sqrt(i=z);r=t-x,s=n-x,u=t+x,c=n+x,e=y.data}}return e}function Ut(t){if(isNaN(u=+this._x.call(null,t))||isNaN(c=+this._y.call(null,t)))return this;var n,i=this._root,e,r,s,o=this._x0,a=this._y0,h=this._x1,l=this._y1,u,c,v,y,_,d,g,f;if(!i)return this;if(i.length)for(;;){if((_=u>=(v=(o+h)/2))?o=v:h=v,(d=c>=(y=(a+l)/2))?a=y:l=y,n=i,!(i=i[g=d<<1|_]))return this;if(!i.length)break;(n[g+1&3]||n[g+2&3]||n[g+3&3])&&(e=n,f=g)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[g]=s:delete n[g],(i=n[0]||n[1]||n[2]||n[3])&&i===(n[3]||n[2]||n[1]||n[0])&&!i.length&&(e?e[f]=i:this._root=i),this):(this._root=s,this)}function Vt(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function tn(){return this._root}function nn(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function en(t){var n=[],i,e=this._root,r,s,o,a,h;for(e&&n.push(new D(e,this._x0,this._y0,this._x1,this._y1));i=n.pop();)if(!t(e=i.node,s=i.x0,o=i.y0,a=i.x1,h=i.y1)&&e.length){var l=(s+a)/2,u=(o+h)/2;(r=e[3])&&n.push(new D(r,l,u,a,h)),(r=e[2])&&n.push(new D(r,s,u,l,h)),(r=e[1])&&n.push(new D(r,l,o,a,u)),(r=e[0])&&n.push(new D(r,s,o,l,u))}return this}function rn(t){var n=[],i=[],e;for(this._root&&n.push(new D(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.y0,h=e.x1,l=e.y1,u=(o+h)/2,c=(a+l)/2;(s=r[0])&&n.push(new D(s,o,a,u,c)),(s=r[1])&&n.push(new D(s,u,a,h,c)),(s=r[2])&&n.push(new D(s,o,c,u,l)),(s=r[3])&&n.push(new D(s,u,c,h,l))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function sn(t){return t[0]}function an(t){return arguments.length?(this._x=t,this):this._x}function fn(t){return t[1]}function on(t){return arguments.length?(this._y=t,this):this._y}function et(t,n,i){var e=new rt(n??sn,i??fn,NaN,NaN,NaN,NaN);return t==null?e:e.addAll(t)}function rt(t,n,i,e,r,s){this._x=t,this._y=n,this._x0=i,this._y0=e,this._x1=r,this._y1=s,this._root=void 0}function gt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var j=et.prototype=rt.prototype;j.copy=function(){var t=new rt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=gt(n),t;for(i=[{source:n,target:t._root=new Array(4)}];n=i.pop();)for(var r=0;r<4;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(4)}):n.target[r]=gt(e));return t},j.add=Pt,j.addAll=Qt,j.cover=Wt,j.data=Gt,j.extent=Jt,j.find=Kt,j.remove=Ut,j.removeAll=Vt,j.root=tn,j.size=nn,j.visit=en,j.visitAfter=rn,j.x=an,j.y=on;function hn(t){const n=+this._x.call(null,t),i=+this._y.call(null,t),e=+this._z.call(null,t);return pt(this.cover(n,i,e),n,i,e,t)}function pt(t,n,i,e,r){if(isNaN(n)||isNaN(i)||isNaN(e))return t;var s,o=t._root,a={data:r},h=t._x0,l=t._y0,u=t._z0,c=t._x1,v=t._y1,y=t._z1,_,d,g,f,p,w,z,x,N,M,A;if(!o)return t._root=a,t;for(;o.length;)if((z=n>=(_=(h+c)/2))?h=_:c=_,(x=i>=(d=(l+v)/2))?l=d:v=d,(N=e>=(g=(u+y)/2))?u=g:y=g,s=o,!(o=o[M=N<<2|x<<1|z]))return s[M]=a,t;if(f=+t._x.call(null,o.data),p=+t._y.call(null,o.data),w=+t._z.call(null,o.data),n===f&&i===p&&e===w)return a.next=o,s?s[M]=a:t._root=a,t;do s=s?s[M]=new Array(8):t._root=new Array(8),(z=n>=(_=(h+c)/2))?h=_:c=_,(x=i>=(d=(l+v)/2))?l=d:v=d,(N=e>=(g=(u+y)/2))?u=g:y=g;while((M=N<<2|x<<1|z)===(A=(w>=g)<<2|(p>=d)<<1|f>=_));return s[A]=o,s[M]=a,t}function un(t){Array.isArray(t)||(t=Array.from(t));const n=t.length,i=new Float64Array(n),e=new Float64Array(n),r=new Float64Array(n);let s=1/0,o=1/0,a=1/0,h=-1/0,l=-1/0,u=-1/0;for(let c=0,v,y,_,d;c<n;++c)isNaN(y=+this._x.call(null,v=t[c]))||isNaN(_=+this._y.call(null,v))||isNaN(d=+this._z.call(null,v))||(i[c]=y,e[c]=_,r[c]=d,y<s&&(s=y),y>h&&(h=y),_<o&&(o=_),_>l&&(l=_),d<a&&(a=d),d>u&&(u=d));if(s>h||o>l||a>u)return this;this.cover(s,o,a).cover(h,l,u);for(let c=0;c<n;++c)pt(this,i[c],e[c],r[c],t[c]);return this}function ln(t,n,i){if(isNaN(t=+t)||isNaN(n=+n)||isNaN(i=+i))return this;var e=this._x0,r=this._y0,s=this._z0,o=this._x1,a=this._y1,h=this._z1;if(isNaN(e))o=(e=Math.floor(t))+1,a=(r=Math.floor(n))+1,h=(s=Math.floor(i))+1;else{for(var l=o-e||1,u=this._root,c,v;e>t||t>=o||r>n||n>=a||s>i||i>=h;)switch(v=(i<s)<<2|(n<r)<<1|t<e,c=new Array(8),c[v]=u,u=c,l*=2,v){case 0:o=e+l,a=r+l,h=s+l;break;case 1:e=o-l,a=r+l,h=s+l;break;case 2:o=e+l,r=a-l,h=s+l;break;case 3:e=o-l,r=a-l,h=s+l;break;case 4:o=e+l,a=r+l,s=h-l;break;case 5:e=o-l,a=r+l,s=h-l;break;case 6:o=e+l,r=a-l,s=h-l;break;case 7:e=o-l,r=a-l,s=h-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=e,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=h,this}function cn(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function _n(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function m(t,n,i,e,r,s,o){this.node=t,this.x0=n,this.y0=i,this.z0=e,this.x1=r,this.y1=s,this.z1=o}function vn(t,n,i,e){var r,s=this._x0,o=this._y0,a=this._z0,h,l,u,c,v,y,_=this._x1,d=this._y1,g=this._z1,f=[],p=this._root,w,z;for(p&&f.push(new m(p,s,o,a,_,d,g)),e==null?e=1/0:(s=t-e,o=n-e,a=i-e,_=t+e,d=n+e,g=i+e,e*=e);w=f.pop();)if(!(!(p=w.node)||(h=w.x0)>_||(l=w.y0)>d||(u=w.z0)>g||(c=w.x1)<s||(v=w.y1)<o||(y=w.z1)<a))if(p.length){var x=(h+c)/2,N=(l+v)/2,M=(u+y)/2;f.push(new m(p[7],x,N,M,c,v,y),new m(p[6],h,N,M,x,v,y),new m(p[5],x,l,M,c,N,y),new m(p[4],h,l,M,x,N,y),new m(p[3],x,N,u,c,v,M),new m(p[2],h,N,u,x,v,M),new m(p[1],x,l,u,c,N,M),new m(p[0],h,l,u,x,N,M)),(z=(i>=M)<<2|(n>=N)<<1|t>=x)&&(w=f[f.length-1],f[f.length-1]=f[f.length-1-z],f[f.length-1-z]=w)}else{var A=t-+this._x.call(null,p.data),E=n-+this._y.call(null,p.data),F=i-+this._z.call(null,p.data),I=A*A+E*E+F*F;if(I<e){var $=Math.sqrt(e=I);s=t-$,o=n-$,a=i-$,_=t+$,d=n+$,g=i+$,r=p.data}}return r}const yn=(t,n,i,e,r,s)=>Math.sqrt((t-e)**2+(n-r)**2+(i-s)**2);function xn(t,n,i,e){const r=[],s=t-e,o=n-e,a=i-e,h=t+e,l=n+e,u=i+e;return this.visit((c,v,y,_,d,g,f)=>{if(!c.length)do{const p=c.data;yn(t,n,i,this._x(p),this._y(p),this._z(p))<=e&&r.push(p)}while(c=c.next);return v>h||y>l||_>u||d<s||g<o||f<a}),r}function gn(t){if(isNaN(v=+this._x.call(null,t))||isNaN(y=+this._y.call(null,t))||isNaN(_=+this._z.call(null,t)))return this;var n,i=this._root,e,r,s,o=this._x0,a=this._y0,h=this._z0,l=this._x1,u=this._y1,c=this._z1,v,y,_,d,g,f,p,w,z,x,N;if(!i)return this;if(i.length)for(;;){if((p=v>=(d=(o+l)/2))?o=d:l=d,(w=y>=(g=(a+u)/2))?a=g:u=g,(z=_>=(f=(h+c)/2))?h=f:c=f,n=i,!(i=i[x=z<<2|w<<1|p]))return this;if(!i.length)break;(n[x+1&7]||n[x+2&7]||n[x+3&7]||n[x+4&7]||n[x+5&7]||n[x+6&7]||n[x+7&7])&&(e=n,N=x)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[x]=s:delete n[x],(i=n[0]||n[1]||n[2]||n[3]||n[4]||n[5]||n[6]||n[7])&&i===(n[7]||n[6]||n[5]||n[4]||n[3]||n[2]||n[1]||n[0])&&!i.length&&(e?e[N]=i:this._root=i),this):(this._root=s,this)}function pn(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function wn(){return this._root}function zn(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function dn(t){var n=[],i,e=this._root,r,s,o,a,h,l,u;for(e&&n.push(new m(e,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=n.pop();)if(!t(e=i.node,s=i.x0,o=i.y0,a=i.z0,h=i.x1,l=i.y1,u=i.z1)&&e.length){var c=(s+h)/2,v=(o+l)/2,y=(a+u)/2;(r=e[7])&&n.push(new m(r,c,v,y,h,l,u)),(r=e[6])&&n.push(new m(r,s,v,y,c,l,u)),(r=e[5])&&n.push(new m(r,c,o,y,h,v,u)),(r=e[4])&&n.push(new m(r,s,o,y,c,v,u)),(r=e[3])&&n.push(new m(r,c,v,a,h,l,y)),(r=e[2])&&n.push(new m(r,s,v,a,c,l,y)),(r=e[1])&&n.push(new m(r,c,o,a,h,v,y)),(r=e[0])&&n.push(new m(r,s,o,a,c,v,y))}return this}function Nn(t){var n=[],i=[],e;for(this._root&&n.push(new m(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.y0,h=e.z0,l=e.x1,u=e.y1,c=e.z1,v=(o+l)/2,y=(a+u)/2,_=(h+c)/2;(s=r[0])&&n.push(new m(s,o,a,h,v,y,_)),(s=r[1])&&n.push(new m(s,v,a,h,l,y,_)),(s=r[2])&&n.push(new m(s,o,y,h,v,u,_)),(s=r[3])&&n.push(new m(s,v,y,h,l,u,_)),(s=r[4])&&n.push(new m(s,o,a,_,v,y,c)),(s=r[5])&&n.push(new m(s,v,a,_,l,y,c)),(s=r[6])&&n.push(new m(s,o,y,_,v,u,c)),(s=r[7])&&n.push(new m(s,v,y,_,l,u,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this}function Mn(t){return t[0]}function An(t){return arguments.length?(this._x=t,this):this._x}function mn(t){return t[1]}function $n(t){return arguments.length?(this._y=t,this):this._y}function bn(t){return t[2]}function qn(t){return arguments.length?(this._z=t,this):this._z}function st(t,n,i,e){var r=new at(n??Mn,i??mn,e??bn,NaN,NaN,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function at(t,n,i,e,r,s,o,a,h){this._x=t,this._y=n,this._z=i,this._x0=e,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=h,this._root=void 0}function wt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var q=st.prototype=at.prototype;q.copy=function(){var t=new at(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=wt(n),t;for(i=[{source:n,target:t._root=new Array(8)}];n=i.pop();)for(var r=0;r<8;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(8)}):n.target[r]=wt(e));return t},q.add=hn,q.addAll=un,q.cover=ln,q.data=cn,q.extent=_n,q.find=vn,q.findAllWithinRadius=xn,q.remove=gn,q.removeAll=pn,q.root=wn,q.size=zn,q.visit=dn,q.visitAfter=Nn,q.x=An,q.y=$n,q.z=qn;function b(t){return function(){return t}}function T(t){return(t()-.5)*1e-6}function ft(t){return t.x+t.vx}function zt(t){return t.y+t.vy}function In(t){return t.z+t.vz}function kn(t){var n,i,e,r,s=1,o=1;typeof t!="function"&&(t=b(t==null?1:+t));function a(){for(var u,c=n.length,v,y,_,d,g,f,p,w=0;w<o;++w)for(v=(i===1?nt(n,ft):i===2?et(n,ft,zt):i===3?st(n,ft,zt,In):null).visitAfter(h),u=0;u<c;++u)y=n[u],f=e[y.index],p=f*f,_=y.x+y.vx,i>1&&(d=y.y+y.vy),i>2&&(g=y.z+y.vz),v.visit(z);function z(x,N,M,A,E,F,I){var $=[N,M,A,E,F,I],V=$[0],ei=$[1],ri=$[2],si=$[i],ai=$[i+1],fi=$[i+2],O=x.data,tt=x.r,k=f+tt;if(O){if(O.index>y.index){var Y=_-O.x-O.vx,Z=i>1?d-O.y-O.vy:0,B=i>2?g-O.z-O.vz:0,X=Y*Y+Z*Z+B*B;X<k*k&&(Y===0&&(Y=T(r),X+=Y*Y),i>1&&Z===0&&(Z=T(r),X+=Z*Z),i>2&&B===0&&(B=T(r),X+=B*B),X=(k-(X=Math.sqrt(X)))/X*s,y.vx+=(Y*=X)*(k=(tt*=tt)/(p+tt)),i>1&&(y.vy+=(Z*=X)*k),i>2&&(y.vz+=(B*=X)*k),O.vx-=Y*(k=1-k),i>1&&(O.vy-=Z*k),i>2&&(O.vz-=B*k))}return}return V>_+k||si<_-k||i>1&&(ei>d+k||ai<d-k)||i>2&&(ri>g+k||fi<g-k)}}function h(u){if(u.data)return u.r=e[u.data.index];for(var c=u.r=0;c<Math.pow(2,i);++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(n){var u,c=n.length,v;for(e=new Array(c),u=0;u<c;++u)v=n[u],e[v.index]=+t(v,u,n)}}return a.initialize=function(u,...c){n=u,r=c.find(v=>typeof v=="function")||Math.random,i=c.find(v=>[1,2,3].includes(v))||2,l()},a.iterations=function(u){return arguments.length?(o=+u,a):o},a.strength=function(u){return arguments.length?(s=+u,a):s},a.radius=function(u){return arguments.length?(t=typeof u=="function"?u:b(+u),l(),a):t},a}function Dn(t){return t.index}function dt(t,n){var i=t.get(n);if(!i)throw new Error("node not found: "+n);return i}function jn(t){var n=Dn,i=v,e,r=b(30),s,o,a,h,l,u,c=1;t==null&&(t=[]);function v(f){return 1/Math.min(h[f.source.index],h[f.target.index])}function y(f){for(var p=0,w=t.length;p<c;++p)for(var z=0,x,N,M,A=0,E=0,F=0,I,$;z<w;++z)x=t[z],N=x.source,M=x.target,A=M.x+M.vx-N.x-N.vx||T(u),a>1&&(E=M.y+M.vy-N.y-N.vy||T(u)),a>2&&(F=M.z+M.vz-N.z-N.vz||T(u)),I=Math.sqrt(A*A+E*E+F*F),I=(I-s[z])/I*f*e[z],A*=I,E*=I,F*=I,M.vx-=A*($=l[z]),a>1&&(M.vy-=E*$),a>2&&(M.vz-=F*$),N.vx+=A*($=1-$),a>1&&(N.vy+=E*$),a>2&&(N.vz+=F*$)}function _(){if(o){var f,p=o.length,w=t.length,z=new Map(o.map((N,M)=>[n(N,M,o),N])),x;for(f=0,h=new Array(p);f<w;++f)x=t[f],x.index=f,typeof x.source!="object"&&(x.source=dt(z,x.source)),typeof x.target!="object"&&(x.target=dt(z,x.target)),h[x.source.index]=(h[x.source.index]||0)+1,h[x.target.index]=(h[x.target.index]||0)+1;for(f=0,l=new Array(w);f<w;++f)x=t[f],l[f]=h[x.source.index]/(h[x.source.index]+h[x.target.index]);e=new Array(w),d(),s=new Array(w),g()}}function d(){if(o)for(var f=0,p=t.length;f<p;++f)e[f]=+i(t[f],f,t)}function g(){if(o)for(var f=0,p=t.length;f<p;++f)s[f]=+r(t[f],f,t)}return y.initialize=function(f,...p){o=f,u=p.find(w=>typeof w=="function")||Math.random,a=p.find(w=>[1,2,3].includes(w))||2,_()},y.links=function(f){return arguments.length?(t=f,_(),y):t},y.id=function(f){return arguments.length?(n=f,y):n},y.iterations=function(f){return arguments.length?(c=+f,y):c},y.strength=function(f){return arguments.length?(i=typeof f=="function"?f:b(+f),d(),y):i},y.distance=function(f){return arguments.length?(r=typeof f=="function"?f:b(+f),g(),y):r},y}var En={value:()=>{}};function Nt(){for(var t=0,n=arguments.length,i={},e;t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new G(i)}function G(t){this._=t}function Fn(t,n){return t.trim().split(/^|\s+/).map(function(i){var e="",r=i.indexOf(".");if(r>=0&&(e=i.slice(r+1),i=i.slice(0,r)),i&&!n.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:e}})}G.prototype=Nt.prototype={constructor:G,on:function(t,n){var i=this._,e=Fn(t+"",i),r,s=-1,o=e.length;if(arguments.length<2){for(;++s<o;)if((r=(t=e[s]).type)&&(r=Sn(i[r],t.name)))return r;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++s<o;)if(r=(t=e[s]).type)i[r]=Mt(i[r],t.name,n);else if(n==null)for(r in i)i[r]=Mt(i[r],t.name,null);return this},copy:function(){var t={},n=this._;for(var i in n)t[i]=n[i].slice();return new G(t)},call:function(t,n){if((r=arguments.length-2)>0)for(var i=new Array(r),e=0,r,s;e<r;++e)i[e]=arguments[e+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],e=0,r=s.length;e<r;++e)s[e].value.apply(n,i)},apply:function(t,n,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var e=this._[t],r=0,s=e.length;r<s;++r)e[r].value.apply(n,i)}};function Sn(t,n){for(var i=0,e=t.length,r;i<e;++i)if((r=t[i]).name===n)return r.value}function Mt(t,n,i){for(var e=0,r=t.length;e<r;++e)if(t[e].name===n){t[e]=En,t=t.slice(0,e).concat(t.slice(e+1));break}return i!=null&&t.push({name:n,value:i}),t}var H=0,L=0,P=0,At=1e3,J,Q,K=0,C=0,U=0,W=typeof performance=="object"&&performance.now?performance:Date,mt=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function $t(){return C||(mt(Tn),C=W.now()+U)}function Tn(){C=0}function ot(){this._call=this._time=this._next=null}ot.prototype=bt.prototype={constructor:ot,restart:function(t,n,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?$t():+i)+(n==null?0:+n),!this._next&&Q!==this&&(Q?Q._next=this:J=this,Q=this),this._call=t,this._time=i,ht()},stop:function(){this._call&&(this._call=null,this._time=1/0,ht())}};function bt(t,n,i){var e=new ot;return e.restart(t,n,i),e}function On(){$t(),++H;for(var t=J,n;t;)(n=C-t._time)>=0&&t._call.call(void 0,n),t=t._next;--H}function qt(){C=(K=W.now())+U,H=L=0;try{On()}finally{H=0,Rn(),C=0}}function Xn(){var t=W.now(),n=t-K;n>At&&(U-=n,K=t)}function Rn(){for(var t,n=J,i,e=1/0;n;)n._call?(e>n._time&&(e=n._time),t=n,n=n._next):(i=n._next,n._next=null,n=t?t._next=i:J=i);Q=t,ht(e)}function ht(t){if(!H){L&&(L=clearTimeout(L));var n=t-C;n>24?(t<1/0&&(L=setTimeout(qt,t-W.now()-U)),P&&(P=clearInterval(P))):(P||(K=W.now(),P=setInterval(Xn,At)),H=1,mt(qt))}}const Yn=1664525,Zn=1013904223,It=4294967296;function Bn(){let t=1;return()=>(t=(Yn*t+Zn)%It)/It}var kt=3;function ut(t){return t.x}function Dt(t){return t.y}function Cn(t){return t.z}var Hn=10,Ln=Math.PI*(3-Math.sqrt(5)),Pn=Math.PI*20/(9+Math.sqrt(221));function Qn(t,n){n=n||2;var i=Math.min(kt,Math.max(1,Math.round(n))),e,r=1,s=.001,o=1-Math.pow(s,1/300),a=0,h=.6,l=new Map,u=bt(y),c=Nt("tick","end"),v=Bn();t==null&&(t=[]);function y(){_(),c.call("tick",e),r<s&&(u.stop(),c.call("end",e))}function _(f){var p,w=t.length,z;f===void 0&&(f=1);for(var x=0;x<f;++x)for(r+=(a-r)*o,l.forEach(function(N){N(r)}),p=0;p<w;++p)z=t[p],z.fx==null?z.x+=z.vx*=h:(z.x=z.fx,z.vx=0),i>1&&(z.fy==null?z.y+=z.vy*=h:(z.y=z.fy,z.vy=0)),i>2&&(z.fz==null?z.z+=z.vz*=h:(z.z=z.fz,z.vz=0));return e}function d(){for(var f=0,p=t.length,w;f<p;++f){if(w=t[f],w.index=f,w.fx!=null&&(w.x=w.fx),w.fy!=null&&(w.y=w.fy),w.fz!=null&&(w.z=w.fz),isNaN(w.x)||i>1&&isNaN(w.y)||i>2&&isNaN(w.z)){var z=Hn*(i>2?Math.cbrt(.5+f):i>1?Math.sqrt(.5+f):f),x=f*Ln,N=f*Pn;i===1?w.x=z:i===2?(w.x=z*Math.cos(x),w.y=z*Math.sin(x)):(w.x=z*Math.sin(x)*Math.cos(N),w.y=z*Math.cos(x),w.z=z*Math.sin(x)*Math.sin(N))}(isNaN(w.vx)||i>1&&isNaN(w.vy)||i>2&&isNaN(w.vz))&&(w.vx=0,i>1&&(w.vy=0),i>2&&(w.vz=0))}}function g(f){return f.initialize&&f.initialize(t,v,i),f}return d(),e={tick:_,restart:function(){return u.restart(y),e},stop:function(){return u.stop(),e},numDimensions:function(f){return arguments.length?(i=Math.min(kt,Math.max(1,Math.round(f))),l.forEach(g),e):i},nodes:function(f){return arguments.length?(t=f,d(),l.forEach(g),e):t},alpha:function(f){return arguments.length?(r=+f,e):r},alphaMin:function(f){return arguments.length?(s=+f,e):s},alphaDecay:function(f){return arguments.length?(o=+f,e):+o},alphaTarget:function(f){return arguments.length?(a=+f,e):a},velocityDecay:function(f){return arguments.length?(h=1-f,e):1-h},randomSource:function(f){return arguments.length?(v=f,l.forEach(g),e):v},force:function(f,p){return arguments.length>1?(p==null?l.delete(f):l.set(f,g(p)),e):l.get(f)},find:function(){var f=Array.prototype.slice.call(arguments),p=f.shift()||0,w=(i>1?f.shift():null)||0,z=(i>2?f.shift():null)||0,x=f.shift()||1/0,N=0,M=t.length,A,E,F,I,$,V;for(x*=x,N=0;N<M;++N)$=t[N],A=p-$.x,E=w-($.y||0),F=z-($.z||0),I=A*A+E*E+F*F,I<x&&(V=$,x=I);return V},on:function(f,p){return arguments.length>1?(c.on(f,p),e):c.on(f)}}}function Wn(){var t,n,i,e,r,s=b(-30),o,a=1,h=1/0,l=.81;function u(_){var d,g=t.length,f=(n===1?nt(t,ut):n===2?et(t,ut,Dt):n===3?st(t,ut,Dt,Cn):null).visitAfter(v);for(r=_,d=0;d<g;++d)i=t[d],f.visit(y)}function c(){if(t){var _,d=t.length,g;for(o=new Array(d),_=0;_<d;++_)g=t[_],o[g.index]=+s(g,_,t)}}function v(_){var d=0,g,f,p=0,w,z,x,N,M=_.length;if(M){for(w=z=x=N=0;N<M;++N)(g=_[N])&&(f=Math.abs(g.value))&&(d+=g.value,p+=f,w+=f*(g.x||0),z+=f*(g.y||0),x+=f*(g.z||0));d*=Math.sqrt(4/M),_.x=w/p,n>1&&(_.y=z/p),n>2&&(_.z=x/p)}else{g=_,g.x=g.data.x,n>1&&(g.y=g.data.y),n>2&&(g.z=g.data.z);do d+=o[g.data.index];while(g=g.next)}_.value=d}function y(_,d,g,f,p){if(!_.value)return!0;var w=[g,f,p][n-1],z=_.x-i.x,x=n>1?_.y-i.y:0,N=n>2?_.z-i.z:0,M=w-d,A=z*z+x*x+N*N;if(M*M/l<A)return A<h&&(z===0&&(z=T(e),A+=z*z),n>1&&x===0&&(x=T(e),A+=x*x),n>2&&N===0&&(N=T(e),A+=N*N),A<a&&(A=Math.sqrt(a*A)),i.vx+=z*_.value*r/A,n>1&&(i.vy+=x*_.value*r/A),n>2&&(i.vz+=N*_.value*r/A)),!0;if(_.length||A>=h)return;(_.data!==i||_.next)&&(z===0&&(z=T(e),A+=z*z),n>1&&x===0&&(x=T(e),A+=x*x),n>2&&N===0&&(N=T(e),A+=N*N),A<a&&(A=Math.sqrt(a*A)));do _.data!==i&&(M=o[_.data.index]*r/A,i.vx+=z*M,n>1&&(i.vy+=x*M),n>2&&(i.vz+=N*M));while(_=_.next)}return u.initialize=function(_,...d){t=_,e=d.find(g=>typeof g=="function")||Math.random,n=d.find(g=>[1,2,3].includes(g))||2,c()},u.strength=function(_){return arguments.length?(s=typeof _=="function"?_:b(+_),c(),u):s},u.distanceMin=function(_){return arguments.length?(a=_*_,u):Math.sqrt(a)},u.distanceMax=function(_){return arguments.length?(h=_*_,u):Math.sqrt(h)},u.theta=function(_){return arguments.length?(l=_*_,u):Math.sqrt(l)},u}function Gn(t){var n=b(.1),i,e,r;typeof t!="function"&&(t=b(t==null?0:+t));function s(a){for(var h=0,l=i.length,u;h<l;++h)u=i[h],u.vx+=(r[h]-u.x)*e[h]*a}function o(){if(i){var a,h=i.length;for(e=new Array(h),r=new Array(h),a=0;a<h;++a)e[a]=isNaN(r[a]=+t(i[a],a,i))?0:+n(i[a],a,i)}}return s.initialize=function(a){i=a,o()},s.strength=function(a){return arguments.length?(n=typeof a=="function"?a:b(+a),o(),s):n},s.x=function(a){return arguments.length?(t=typeof a=="function"?a:b(+a),o(),s):t},s}function Jn(t){var n=b(.1),i,e,r;typeof t!="function"&&(t=b(t==null?0:+t));function s(a){for(var h=0,l=i.length,u;h<l;++h)u=i[h],u.vy+=(r[h]-u.y)*e[h]*a}function o(){if(i){var a,h=i.length;for(e=new Array(h),r=new Array(h),a=0;a<h;++a)e[a]=isNaN(r[a]=+t(i[a],a,i))?0:+n(i[a],a,i)}}return s.initialize=function(a){i=a,o()},s.strength=function(a){return arguments.length?(n=typeof a=="function"?a:b(+a),o(),s):n},s.y=function(a){return arguments.length?(t=typeof a=="function"?a:b(+a),o(),s):t},s}function Kn(t){var n=b(.1),i,e,r;typeof t!="function"&&(t=b(t==null?0:+t));function s(a){for(var h=0,l=i.length,u;h<l;++h)u=i[h],u.vz+=(r[h]-u.z)*e[h]*a}function o(){if(i){var a,h=i.length;for(e=new Array(h),r=new Array(h),a=0;a<h;++a)e[a]=isNaN(r[a]=+t(i[a],a,i))?0:+n(i[a],a,i)}}return s.initialize=function(a){i=a,o()},s.strength=function(a){return arguments.length?(n=typeof a=="function"?a:b(+a),o(),s):n},s.z=function(a){return arguments.length?(t=typeof a=="function"?a:b(+a),o(),s):t},s}function lt(t){let n=2166136261;const i=String(t??"");for(let e=0;e<i.length;e+=1)n^=i.charCodeAt(e),n=Math.imul(n,16777619);return n>>>0}function ct(t,n){const i=lt(`${t}:a`)%360*Math.PI/180,e=(lt(`${t}:p`)%120-60)*Math.PI/180,r=n+lt(`${t}:r`)%24;return{x:Math.cos(i)*Math.cos(e)*r,y:Math.sin(e)*r*.72,z:Math.sin(i)*Math.cos(e)*r}}function _t(t,n){var s,o,a;const i={x:Number(((s=t.layout)==null?void 0:s.seedX)??0),y:Number(((o=t.layout)==null?void 0:o.seedY)??0),z:Number(((a=t.layout)==null?void 0:a.seedZ)??0)},e=t.anchorRef?n.get(t.anchorRef):null;if(t.kind==="entity"||!e)return i;if(t.kind==="commitment"){const h=ct(t.id,34);return{x:e.x+h.x*.6,y:e.y+48+h.y,z:e.z+30+h.z*.45}}if(t.kind==="pattern"){const h=ct(t.id,72);return{x:e.x+h.x,y:e.y+h.y*.7,z:e.z-56+h.z}}const r=ct(t.id,46);return{x:e.x+r.x*.75,y:e.y+18+r.y,z:e.z+r.z*.75}}function Un(t){return t.kind==="entity"?-180-Number(t.importance||0)*90:t.kind==="pattern"?-70:t.kind==="commitment"?-55:-26}function Vn(t){return Math.max(16,Number(t.size||5)*(t.kind==="entity"?3.2:2.4))}function ti(t){return t.channel==="trace"?54:t.channel==="relationship"?84-Math.min(Number(t.strength||0)*22,22):t.channel==="commitment"?40:34}function ni(t){return t.channel==="trace"?.4:t.channel==="relationship"?.12+Number(t.strength||0)*.16:t.channel==="commitment"?.22:.16}function ii(t){const n={},i={};for(const e of t)n[e.id]={x:e.x||0,y:e.y||0,z:e.z||0},i[e.id]={x:e.vx||0,y:e.vy||0,z:e.vz||0};return{positions:n,velocities:i}}self.onmessage=t=>{const{type:n,jobId:i,nodes:e=[],edges:r=[],previousPositions:s={},motionLevel:o="full"}=t.data||{};if(n!=="layout")return;const a=new Map(e.map(f=>{var p,w,z,x,N,M;return[f.id,{...f,x:Number(((p=s==null?void 0:s[f.id])==null?void 0:p.x)??((w=f.layout)==null?void 0:w.seedX)??0),y:Number(((z=s==null?void 0:s[f.id])==null?void 0:z.y)??((x=f.layout)==null?void 0:x.seedY)??0),z:Number(((N=s==null?void 0:s[f.id])==null?void 0:N.z)??((M=f.layout)==null?void 0:M.seedZ)??0)}]})),h=[...a.values()],l=r.filter(f=>a.has(f.source)&&a.has(f.target)).map(f=>({...f})),u=e.filter(f=>s==null?void 0:s[f.id]).length,c=e.length?u/e.length:0,v=c>.7?o==="reduced"?18:o==="restrained"?24:30:o==="reduced"?90:o==="restrained"?120:160,y=e.length>900?.48:e.length>500?.62:e.length>260?.82:1,_=Math.max(16,Math.round(v*y)),d=c>.7?.018:o==="reduced"?.09:.05,g=Qn(h,3).alpha(c>.7?.22:1).alphaDecay(c>.7?.14:o==="full"?.038:.05).velocityDecay(o==="full"?.22:.3).force("charge",Wn().strength(Un).distanceMax(520)).force("collide",kn().radius(Vn).strength(.85)).force("link",jn(l).id(f=>f.id).distance(ti).strength(ni)).force("homeX",Gn(f=>_t(f,a).x).strength(d)).force("homeY",Jn(f=>_t(f,a).y).strength(d)).force("homeZ",Kn(f=>_t(f,a).z).strength(d));for(let f=0;f<_;f+=1)if(g.tick(),f===0||f%10===0||f===_-1){const p=ii(h);self.postMessage({type:"snapshot",jobId:i,positions:p.positions,velocities:p.velocities,done:f===_-1})}g.stop()}})();
//# sourceMappingURL=layoutWorker-DLEisV_c.js.map
