(function(){"use strict";function Ft(t){const n=+this._x.call(null,t);return vt(this.cover(n),n,t)}function vt(t,n,i){if(isNaN(n))return t;var e,r=t._root,s={data:i},o=t._x0,a=t._x1,f,l,u,c,y;if(!r)return t._root=s,t;for(;r.length;)if((u=n>=(f=(o+a)/2))?o=f:a=f,e=r,!(r=r[c=+u]))return e[c]=s,t;if(l=+t._x.call(null,r.data),n===l)return s.next=r,e?e[c]=s:t._root=s,t;do e=e?e[c]=new Array(2):t._root=new Array(2),(u=n>=(f=(o+a)/2))?o=f:a=f;while((c=+u)==(y=+(l>=f)));return e[y]=r,e[c]=s,t}function jt(t){Array.isArray(t)||(t=Array.from(t));const n=t.length,i=new Float64Array(n);let e=1/0,r=-1/0;for(let s=0,o;s<n;++s)isNaN(o=+this._x.call(null,t[s]))||(i[s]=o,o<e&&(e=o),o>r&&(r=o));if(e>r)return this;this.cover(e).cover(r);for(let s=0;s<n;++s)vt(this,i[s],t[s]);return this}function Et(t){if(isNaN(t=+t))return this;var n=this._x0,i=this._x1;if(isNaN(n))i=(n=Math.floor(t))+1;else{for(var e=i-n||1,r=this._root,s,o;n>t||t>=i;)switch(o=+(t<n),s=new Array(2),s[o]=r,r=s,e*=2,o){case 0:i=n+e;break;case 1:n=i-e;break}this._root&&this._root.length&&(this._root=r)}return this._x0=n,this._x1=i,this}function St(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function Tt(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function R(t,n,i){this.node=t,this.x0=n,this.x1=i}function Ot(t,n){var i,e=this._x0,r,s,o=this._x1,a=[],f=this._root,l,u;for(f&&a.push(new R(f,e,o)),n==null?n=1/0:(e=t-n,o=t+n);l=a.pop();)if(!(!(f=l.node)||(r=l.x0)>o||(s=l.x1)<e))if(f.length){var c=(r+s)/2;a.push(new R(f[1],c,s),new R(f[0],r,c)),(u=+(t>=c))&&(l=a[a.length-1],a[a.length-1]=a[a.length-1-u],a[a.length-1-u]=l)}else{var y=Math.abs(t-+this._x.call(null,f.data));y<n&&(n=y,e=t-y,o=t+y,i=f.data)}return i}function Xt(t){if(isNaN(f=+this._x.call(null,t)))return this;var n,i=this._root,e,r,s,o=this._x0,a=this._x1,f,l,u,c,y;if(!i)return this;if(i.length)for(;;){if((u=f>=(l=(o+a)/2))?o=l:a=l,n=i,!(i=i[c=+u]))return this;if(!i.length)break;n[c+1&1]&&(e=n,y=c)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[c]=s:delete n[c],(i=n[0]||n[1])&&i===(n[1]||n[0])&&!i.length&&(e?e[y]=i:this._root=i),this):(this._root=s,this)}function Rt(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function Yt(){return this._root}function Zt(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function Bt(t){var n=[],i,e=this._root,r,s,o;for(e&&n.push(new R(e,this._x0,this._x1));i=n.pop();)if(!t(e=i.node,s=i.x0,o=i.x1)&&e.length){var a=(s+o)/2;(r=e[1])&&n.push(new R(r,a,o)),(r=e[0])&&n.push(new R(r,s,a))}return this}function Ct(t){var n=[],i=[],e;for(this._root&&n.push(new R(this._root,this._x0,this._x1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.x1,f=(o+a)/2;(s=r[0])&&n.push(new R(s,o,f)),(s=r[1])&&n.push(new R(s,f,a))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.x1);return this}function Ht(t){return t[0]}function Lt(t){return arguments.length?(this._x=t,this):this._x}function nt(t,n){var i=new it(n??Ht,NaN,NaN);return t==null?i:i.addAll(t)}function it(t,n,i){this._x=t,this._x0=n,this._x1=i,this._root=void 0}function yt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var S=nt.prototype=it.prototype;S.copy=function(){var t=new it(this._x,this._x0,this._x1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=yt(n),t;for(i=[{source:n,target:t._root=new Array(2)}];n=i.pop();)for(var r=0;r<2;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(2)}):n.target[r]=yt(e));return t},S.add=Ft,S.addAll=jt,S.cover=Et,S.data=St,S.extent=Tt,S.find=Ot,S.remove=Xt,S.removeAll=Rt,S.root=Yt,S.size=Zt,S.visit=Bt,S.visitAfter=Ct,S.x=Lt;function Pt(t){const n=+this._x.call(null,t),i=+this._y.call(null,t);return xt(this.cover(n,i),n,i,t)}function xt(t,n,i,e){if(isNaN(n)||isNaN(i))return t;var r,s=t._root,o={data:e},a=t._x0,f=t._y0,l=t._x1,u=t._y1,c,y,x,_,N,p,h,v;if(!s)return t._root=o,t;for(;s.length;)if((N=n>=(c=(a+l)/2))?a=c:l=c,(p=i>=(y=(f+u)/2))?f=y:u=y,r=s,!(s=s[h=p<<1|N]))return r[h]=o,t;if(x=+t._x.call(null,s.data),_=+t._y.call(null,s.data),n===x&&i===_)return o.next=s,r?r[h]=o:t._root=o,t;do r=r?r[h]=new Array(4):t._root=new Array(4),(N=n>=(c=(a+l)/2))?a=c:l=c,(p=i>=(y=(f+u)/2))?f=y:u=y;while((h=p<<1|N)===(v=(_>=y)<<1|x>=c));return r[v]=s,r[h]=o,t}function Qt(t){var n,i,e=t.length,r,s,o=new Array(e),a=new Array(e),f=1/0,l=1/0,u=-1/0,c=-1/0;for(i=0;i<e;++i)isNaN(r=+this._x.call(null,n=t[i]))||isNaN(s=+this._y.call(null,n))||(o[i]=r,a[i]=s,r<f&&(f=r),r>u&&(u=r),s<l&&(l=s),s>c&&(c=s));if(f>u||l>c)return this;for(this.cover(f,l).cover(u,c),i=0;i<e;++i)xt(this,o[i],a[i],t[i]);return this}function Wt(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var i=this._x0,e=this._y0,r=this._x1,s=this._y1;if(isNaN(i))r=(i=Math.floor(t))+1,s=(e=Math.floor(n))+1;else{for(var o=r-i||1,a=this._root,f,l;i>t||t>=r||e>n||n>=s;)switch(l=(n<e)<<1|t<i,f=new Array(4),f[l]=a,a=f,o*=2,l){case 0:r=i+o,s=e+o;break;case 1:i=r-o,s=e+o;break;case 2:r=i+o,e=s-o;break;case 3:i=r-o,e=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=i,this._y0=e,this._x1=r,this._y1=s,this}function Gt(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function Jt(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function D(t,n,i,e,r){this.node=t,this.x0=n,this.y0=i,this.x1=e,this.y1=r}function Kt(t,n,i){var e,r=this._x0,s=this._y0,o,a,f,l,u=this._x1,c=this._y1,y=[],x=this._root,_,N;for(x&&y.push(new D(x,r,s,u,c)),i==null?i=1/0:(r=t-i,s=n-i,u=t+i,c=n+i,i*=i);_=y.pop();)if(!(!(x=_.node)||(o=_.x0)>u||(a=_.y0)>c||(f=_.x1)<r||(l=_.y1)<s))if(x.length){var p=(o+f)/2,h=(a+l)/2;y.push(new D(x[3],p,h,f,l),new D(x[2],o,h,p,l),new D(x[1],p,a,f,h),new D(x[0],o,a,p,h)),(N=(n>=h)<<1|t>=p)&&(_=y[y.length-1],y[y.length-1]=y[y.length-1-N],y[y.length-1-N]=_)}else{var v=t-+this._x.call(null,x.data),w=n-+this._y.call(null,x.data),z=v*v+w*w;if(z<i){var g=Math.sqrt(i=z);r=t-g,s=n-g,u=t+g,c=n+g,e=x.data}}return e}function Ut(t){if(isNaN(u=+this._x.call(null,t))||isNaN(c=+this._y.call(null,t)))return this;var n,i=this._root,e,r,s,o=this._x0,a=this._y0,f=this._x1,l=this._y1,u,c,y,x,_,N,p,h;if(!i)return this;if(i.length)for(;;){if((_=u>=(y=(o+f)/2))?o=y:f=y,(N=c>=(x=(a+l)/2))?a=x:l=x,n=i,!(i=i[p=N<<1|_]))return this;if(!i.length)break;(n[p+1&3]||n[p+2&3]||n[p+3&3])&&(e=n,h=p)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[p]=s:delete n[p],(i=n[0]||n[1]||n[2]||n[3])&&i===(n[3]||n[2]||n[1]||n[0])&&!i.length&&(e?e[h]=i:this._root=i),this):(this._root=s,this)}function Vt(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function tn(){return this._root}function nn(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function en(t){var n=[],i,e=this._root,r,s,o,a,f;for(e&&n.push(new D(e,this._x0,this._y0,this._x1,this._y1));i=n.pop();)if(!t(e=i.node,s=i.x0,o=i.y0,a=i.x1,f=i.y1)&&e.length){var l=(s+a)/2,u=(o+f)/2;(r=e[3])&&n.push(new D(r,l,u,a,f)),(r=e[2])&&n.push(new D(r,s,u,l,f)),(r=e[1])&&n.push(new D(r,l,o,a,u)),(r=e[0])&&n.push(new D(r,s,o,l,u))}return this}function rn(t){var n=[],i=[],e;for(this._root&&n.push(new D(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.y0,f=e.x1,l=e.y1,u=(o+f)/2,c=(a+l)/2;(s=r[0])&&n.push(new D(s,o,a,u,c)),(s=r[1])&&n.push(new D(s,u,a,f,c)),(s=r[2])&&n.push(new D(s,o,c,u,l)),(s=r[3])&&n.push(new D(s,u,c,f,l))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function sn(t){return t[0]}function an(t){return arguments.length?(this._x=t,this):this._x}function fn(t){return t[1]}function on(t){return arguments.length?(this._y=t,this):this._y}function et(t,n,i){var e=new rt(n??sn,i??fn,NaN,NaN,NaN,NaN);return t==null?e:e.addAll(t)}function rt(t,n,i,e,r,s){this._x=t,this._y=n,this._x0=i,this._y0=e,this._x1=r,this._y1=s,this._root=void 0}function gt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var F=et.prototype=rt.prototype;F.copy=function(){var t=new rt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=gt(n),t;for(i=[{source:n,target:t._root=new Array(4)}];n=i.pop();)for(var r=0;r<4;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(4)}):n.target[r]=gt(e));return t},F.add=Pt,F.addAll=Qt,F.cover=Wt,F.data=Gt,F.extent=Jt,F.find=Kt,F.remove=Ut,F.removeAll=Vt,F.root=tn,F.size=nn,F.visit=en,F.visitAfter=rn,F.x=an,F.y=on;function hn(t){const n=+this._x.call(null,t),i=+this._y.call(null,t),e=+this._z.call(null,t);return pt(this.cover(n,i,e),n,i,e,t)}function pt(t,n,i,e,r){if(isNaN(n)||isNaN(i)||isNaN(e))return t;var s,o=t._root,a={data:r},f=t._x0,l=t._y0,u=t._z0,c=t._x1,y=t._y1,x=t._z1,_,N,p,h,v,w,z,g,d,M,m;if(!o)return t._root=a,t;for(;o.length;)if((z=n>=(_=(f+c)/2))?f=_:c=_,(g=i>=(N=(l+y)/2))?l=N:y=N,(d=e>=(p=(u+x)/2))?u=p:x=p,s=o,!(o=o[M=d<<2|g<<1|z]))return s[M]=a,t;if(h=+t._x.call(null,o.data),v=+t._y.call(null,o.data),w=+t._z.call(null,o.data),n===h&&i===v&&e===w)return a.next=o,s?s[M]=a:t._root=a,t;do s=s?s[M]=new Array(8):t._root=new Array(8),(z=n>=(_=(f+c)/2))?f=_:c=_,(g=i>=(N=(l+y)/2))?l=N:y=N,(d=e>=(p=(u+x)/2))?u=p:x=p;while((M=d<<2|g<<1|z)===(m=(w>=p)<<2|(v>=N)<<1|h>=_));return s[m]=o,s[M]=a,t}function un(t){Array.isArray(t)||(t=Array.from(t));const n=t.length,i=new Float64Array(n),e=new Float64Array(n),r=new Float64Array(n);let s=1/0,o=1/0,a=1/0,f=-1/0,l=-1/0,u=-1/0;for(let c=0,y,x,_,N;c<n;++c)isNaN(x=+this._x.call(null,y=t[c]))||isNaN(_=+this._y.call(null,y))||isNaN(N=+this._z.call(null,y))||(i[c]=x,e[c]=_,r[c]=N,x<s&&(s=x),x>f&&(f=x),_<o&&(o=_),_>l&&(l=_),N<a&&(a=N),N>u&&(u=N));if(s>f||o>l||a>u)return this;this.cover(s,o,a).cover(f,l,u);for(let c=0;c<n;++c)pt(this,i[c],e[c],r[c],t[c]);return this}function ln(t,n,i){if(isNaN(t=+t)||isNaN(n=+n)||isNaN(i=+i))return this;var e=this._x0,r=this._y0,s=this._z0,o=this._x1,a=this._y1,f=this._z1;if(isNaN(e))o=(e=Math.floor(t))+1,a=(r=Math.floor(n))+1,f=(s=Math.floor(i))+1;else{for(var l=o-e||1,u=this._root,c,y;e>t||t>=o||r>n||n>=a||s>i||i>=f;)switch(y=(i<s)<<2|(n<r)<<1|t<e,c=new Array(8),c[y]=u,u=c,l*=2,y){case 0:o=e+l,a=r+l,f=s+l;break;case 1:e=o-l,a=r+l,f=s+l;break;case 2:o=e+l,r=a-l,f=s+l;break;case 3:e=o-l,r=a-l,f=s+l;break;case 4:o=e+l,a=r+l,s=f-l;break;case 5:e=o-l,a=r+l,s=f-l;break;case 6:o=e+l,r=a-l,s=f-l;break;case 7:e=o-l,r=a-l,s=f-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=e,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=f,this}function cn(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function _n(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function A(t,n,i,e,r,s,o){this.node=t,this.x0=n,this.y0=i,this.z0=e,this.x1=r,this.y1=s,this.z1=o}function vn(t,n,i,e){var r,s=this._x0,o=this._y0,a=this._z0,f,l,u,c,y,x,_=this._x1,N=this._y1,p=this._z1,h=[],v=this._root,w,z;for(v&&h.push(new A(v,s,o,a,_,N,p)),e==null?e=1/0:(s=t-e,o=n-e,a=i-e,_=t+e,N=n+e,p=i+e,e*=e);w=h.pop();)if(!(!(v=w.node)||(f=w.x0)>_||(l=w.y0)>N||(u=w.z0)>p||(c=w.x1)<s||(y=w.y1)<o||(x=w.z1)<a))if(v.length){var g=(f+c)/2,d=(l+y)/2,M=(u+x)/2;h.push(new A(v[7],g,d,M,c,y,x),new A(v[6],f,d,M,g,y,x),new A(v[5],g,l,M,c,d,x),new A(v[4],f,l,M,g,d,x),new A(v[3],g,d,u,c,y,M),new A(v[2],f,d,u,g,y,M),new A(v[1],g,l,u,c,d,M),new A(v[0],f,l,u,g,d,M)),(z=(i>=M)<<2|(n>=d)<<1|t>=g)&&(w=h[h.length-1],h[h.length-1]=h[h.length-1-z],h[h.length-1-z]=w)}else{var m=t-+this._x.call(null,v.data),j=n-+this._y.call(null,v.data),E=i-+this._z.call(null,v.data),I=m*m+j*j+E*E;if(I<e){var $=Math.sqrt(e=I);s=t-$,o=n-$,a=i-$,_=t+$,N=n+$,p=i+$,r=v.data}}return r}const yn=(t,n,i,e,r,s)=>Math.sqrt((t-e)**2+(n-r)**2+(i-s)**2);function xn(t,n,i,e){const r=[],s=t-e,o=n-e,a=i-e,f=t+e,l=n+e,u=i+e;return this.visit((c,y,x,_,N,p,h)=>{if(!c.length)do{const v=c.data;yn(t,n,i,this._x(v),this._y(v),this._z(v))<=e&&r.push(v)}while(c=c.next);return y>f||x>l||_>u||N<s||p<o||h<a}),r}function gn(t){if(isNaN(y=+this._x.call(null,t))||isNaN(x=+this._y.call(null,t))||isNaN(_=+this._z.call(null,t)))return this;var n,i=this._root,e,r,s,o=this._x0,a=this._y0,f=this._z0,l=this._x1,u=this._y1,c=this._z1,y,x,_,N,p,h,v,w,z,g,d;if(!i)return this;if(i.length)for(;;){if((v=y>=(N=(o+l)/2))?o=N:l=N,(w=x>=(p=(a+u)/2))?a=p:u=p,(z=_>=(h=(f+c)/2))?f=h:c=h,n=i,!(i=i[g=z<<2|w<<1|v]))return this;if(!i.length)break;(n[g+1&7]||n[g+2&7]||n[g+3&7]||n[g+4&7]||n[g+5&7]||n[g+6&7]||n[g+7&7])&&(e=n,d=g)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[g]=s:delete n[g],(i=n[0]||n[1]||n[2]||n[3]||n[4]||n[5]||n[6]||n[7])&&i===(n[7]||n[6]||n[5]||n[4]||n[3]||n[2]||n[1]||n[0])&&!i.length&&(e?e[d]=i:this._root=i),this):(this._root=s,this)}function pn(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function wn(){return this._root}function zn(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function Nn(t){var n=[],i,e=this._root,r,s,o,a,f,l,u;for(e&&n.push(new A(e,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=n.pop();)if(!t(e=i.node,s=i.x0,o=i.y0,a=i.z0,f=i.x1,l=i.y1,u=i.z1)&&e.length){var c=(s+f)/2,y=(o+l)/2,x=(a+u)/2;(r=e[7])&&n.push(new A(r,c,y,x,f,l,u)),(r=e[6])&&n.push(new A(r,s,y,x,c,l,u)),(r=e[5])&&n.push(new A(r,c,o,x,f,y,u)),(r=e[4])&&n.push(new A(r,s,o,x,c,y,u)),(r=e[3])&&n.push(new A(r,c,y,a,f,l,x)),(r=e[2])&&n.push(new A(r,s,y,a,c,l,x)),(r=e[1])&&n.push(new A(r,c,o,a,f,y,x)),(r=e[0])&&n.push(new A(r,s,o,a,c,y,x))}return this}function dn(t){var n=[],i=[],e;for(this._root&&n.push(new A(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var r=e.node;if(r.length){var s,o=e.x0,a=e.y0,f=e.z0,l=e.x1,u=e.y1,c=e.z1,y=(o+l)/2,x=(a+u)/2,_=(f+c)/2;(s=r[0])&&n.push(new A(s,o,a,f,y,x,_)),(s=r[1])&&n.push(new A(s,y,a,f,l,x,_)),(s=r[2])&&n.push(new A(s,o,x,f,y,u,_)),(s=r[3])&&n.push(new A(s,y,x,f,l,u,_)),(s=r[4])&&n.push(new A(s,o,a,_,y,x,c)),(s=r[5])&&n.push(new A(s,y,a,_,l,x,c)),(s=r[6])&&n.push(new A(s,o,x,_,y,u,c)),(s=r[7])&&n.push(new A(s,y,x,_,l,u,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this}function Mn(t){return t[0]}function mn(t){return arguments.length?(this._x=t,this):this._x}function An(t){return t[1]}function $n(t){return arguments.length?(this._y=t,this):this._y}function bn(t){return t[2]}function qn(t){return arguments.length?(this._z=t,this):this._z}function st(t,n,i,e){var r=new at(n??Mn,i??An,e??bn,NaN,NaN,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function at(t,n,i,e,r,s,o,a,f){this._x=t,this._y=n,this._z=i,this._x0=e,this._y0=r,this._z0=s,this._x1=o,this._y1=a,this._z1=f,this._root=void 0}function wt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var q=st.prototype=at.prototype;q.copy=function(){var t=new at(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=wt(n),t;for(i=[{source:n,target:t._root=new Array(8)}];n=i.pop();)for(var r=0;r<8;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(8)}):n.target[r]=wt(e));return t},q.add=hn,q.addAll=un,q.cover=ln,q.data=cn,q.extent=_n,q.find=vn,q.findAllWithinRadius=xn,q.remove=gn,q.removeAll=pn,q.root=wn,q.size=zn,q.visit=Nn,q.visitAfter=dn,q.x=mn,q.y=$n,q.z=qn;function b(t){return function(){return t}}function T(t){return(t()-.5)*1e-6}function ft(t){return t.x+t.vx}function zt(t){return t.y+t.vy}function In(t){return t.z+t.vz}function kn(t){var n,i,e,r,s=1,o=1;typeof t!="function"&&(t=b(t==null?1:+t));function a(){for(var u,c=n.length,y,x,_,N,p,h,v,w=0;w<o;++w)for(y=(i===1?nt(n,ft):i===2?et(n,ft,zt):i===3?st(n,ft,zt,In):null).visitAfter(f),u=0;u<c;++u)x=n[u],h=e[x.index],v=h*h,_=x.x+x.vx,i>1&&(N=x.y+x.vy),i>2&&(p=x.z+x.vz),y.visit(z);function z(g,d,M,m,j,E,I){var $=[d,M,m,j,E,I],V=$[0],ri=$[1],si=$[2],ai=$[i],fi=$[i+1],oi=$[i+2],O=g.data,tt=g.r,k=h+tt;if(O){if(O.index>x.index){var Y=_-O.x-O.vx,Z=i>1?N-O.y-O.vy:0,B=i>2?p-O.z-O.vz:0,X=Y*Y+Z*Z+B*B;X<k*k&&(Y===0&&(Y=T(r),X+=Y*Y),i>1&&Z===0&&(Z=T(r),X+=Z*Z),i>2&&B===0&&(B=T(r),X+=B*B),X=(k-(X=Math.sqrt(X)))/X*s,x.vx+=(Y*=X)*(k=(tt*=tt)/(v+tt)),i>1&&(x.vy+=(Z*=X)*k),i>2&&(x.vz+=(B*=X)*k),O.vx-=Y*(k=1-k),i>1&&(O.vy-=Z*k),i>2&&(O.vz-=B*k))}return}return V>_+k||ai<_-k||i>1&&(ri>N+k||fi<N-k)||i>2&&(si>p+k||oi<p-k)}}function f(u){if(u.data)return u.r=e[u.data.index];for(var c=u.r=0;c<Math.pow(2,i);++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(n){var u,c=n.length,y;for(e=new Array(c),u=0;u<c;++u)y=n[u],e[y.index]=+t(y,u,n)}}return a.initialize=function(u,...c){n=u,r=c.find(y=>typeof y=="function")||Math.random,i=c.find(y=>[1,2,3].includes(y))||2,l()},a.iterations=function(u){return arguments.length?(o=+u,a):o},a.strength=function(u){return arguments.length?(s=+u,a):s},a.radius=function(u){return arguments.length?(t=typeof u=="function"?u:b(+u),l(),a):t},a}function Dn(t){return t.index}function Nt(t,n){var i=t.get(n);if(!i)throw new Error("node not found: "+n);return i}function Fn(t){var n=Dn,i=y,e,r=b(30),s,o,a,f,l,u,c=1;t==null&&(t=[]);function y(h){return 1/Math.min(f[h.source.index],f[h.target.index])}function x(h){for(var v=0,w=t.length;v<c;++v)for(var z=0,g,d,M,m=0,j=0,E=0,I,$;z<w;++z)g=t[z],d=g.source,M=g.target,m=M.x+M.vx-d.x-d.vx||T(u),a>1&&(j=M.y+M.vy-d.y-d.vy||T(u)),a>2&&(E=M.z+M.vz-d.z-d.vz||T(u)),I=Math.sqrt(m*m+j*j+E*E),I=(I-s[z])/I*h*e[z],m*=I,j*=I,E*=I,M.vx-=m*($=l[z]),a>1&&(M.vy-=j*$),a>2&&(M.vz-=E*$),d.vx+=m*($=1-$),a>1&&(d.vy+=j*$),a>2&&(d.vz+=E*$)}function _(){if(o){var h,v=o.length,w=t.length,z=new Map(o.map((d,M)=>[n(d,M,o),d])),g;for(h=0,f=new Array(v);h<w;++h)g=t[h],g.index=h,typeof g.source!="object"&&(g.source=Nt(z,g.source)),typeof g.target!="object"&&(g.target=Nt(z,g.target)),f[g.source.index]=(f[g.source.index]||0)+1,f[g.target.index]=(f[g.target.index]||0)+1;for(h=0,l=new Array(w);h<w;++h)g=t[h],l[h]=f[g.source.index]/(f[g.source.index]+f[g.target.index]);e=new Array(w),N(),s=new Array(w),p()}}function N(){if(o)for(var h=0,v=t.length;h<v;++h)e[h]=+i(t[h],h,t)}function p(){if(o)for(var h=0,v=t.length;h<v;++h)s[h]=+r(t[h],h,t)}return x.initialize=function(h,...v){o=h,u=v.find(w=>typeof w=="function")||Math.random,a=v.find(w=>[1,2,3].includes(w))||2,_()},x.links=function(h){return arguments.length?(t=h,_(),x):t},x.id=function(h){return arguments.length?(n=h,x):n},x.iterations=function(h){return arguments.length?(c=+h,x):c},x.strength=function(h){return arguments.length?(i=typeof h=="function"?h:b(+h),N(),x):i},x.distance=function(h){return arguments.length?(r=typeof h=="function"?h:b(+h),p(),x):r},x}var jn={value:()=>{}};function dt(){for(var t=0,n=arguments.length,i={},e;t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new G(i)}function G(t){this._=t}function En(t,n){return t.trim().split(/^|\s+/).map(function(i){var e="",r=i.indexOf(".");if(r>=0&&(e=i.slice(r+1),i=i.slice(0,r)),i&&!n.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:e}})}G.prototype=dt.prototype={constructor:G,on:function(t,n){var i=this._,e=En(t+"",i),r,s=-1,o=e.length;if(arguments.length<2){for(;++s<o;)if((r=(t=e[s]).type)&&(r=Sn(i[r],t.name)))return r;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++s<o;)if(r=(t=e[s]).type)i[r]=Mt(i[r],t.name,n);else if(n==null)for(r in i)i[r]=Mt(i[r],t.name,null);return this},copy:function(){var t={},n=this._;for(var i in n)t[i]=n[i].slice();return new G(t)},call:function(t,n){if((r=arguments.length-2)>0)for(var i=new Array(r),e=0,r,s;e<r;++e)i[e]=arguments[e+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],e=0,r=s.length;e<r;++e)s[e].value.apply(n,i)},apply:function(t,n,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var e=this._[t],r=0,s=e.length;r<s;++r)e[r].value.apply(n,i)}};function Sn(t,n){for(var i=0,e=t.length,r;i<e;++i)if((r=t[i]).name===n)return r.value}function Mt(t,n,i){for(var e=0,r=t.length;e<r;++e)if(t[e].name===n){t[e]=jn,t=t.slice(0,e).concat(t.slice(e+1));break}return i!=null&&t.push({name:n,value:i}),t}var H=0,L=0,P=0,mt=1e3,J,Q,K=0,C=0,U=0,W=typeof performance=="object"&&performance.now?performance:Date,At=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function $t(){return C||(At(Tn),C=W.now()+U)}function Tn(){C=0}function ot(){this._call=this._time=this._next=null}ot.prototype=bt.prototype={constructor:ot,restart:function(t,n,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?$t():+i)+(n==null?0:+n),!this._next&&Q!==this&&(Q?Q._next=this:J=this,Q=this),this._call=t,this._time=i,ht()},stop:function(){this._call&&(this._call=null,this._time=1/0,ht())}};function bt(t,n,i){var e=new ot;return e.restart(t,n,i),e}function On(){$t(),++H;for(var t=J,n;t;)(n=C-t._time)>=0&&t._call.call(void 0,n),t=t._next;--H}function qt(){C=(K=W.now())+U,H=L=0;try{On()}finally{H=0,Rn(),C=0}}function Xn(){var t=W.now(),n=t-K;n>mt&&(U-=n,K=t)}function Rn(){for(var t,n=J,i,e=1/0;n;)n._call?(e>n._time&&(e=n._time),t=n,n=n._next):(i=n._next,n._next=null,n=t?t._next=i:J=i);Q=t,ht(e)}function ht(t){if(!H){L&&(L=clearTimeout(L));var n=t-C;n>24?(t<1/0&&(L=setTimeout(qt,t-W.now()-U)),P&&(P=clearInterval(P))):(P||(K=W.now(),P=setInterval(Xn,mt)),H=1,At(qt))}}const Yn=1664525,Zn=1013904223,It=4294967296;function Bn(){let t=1;return()=>(t=(Yn*t+Zn)%It)/It}var kt=3;function ut(t){return t.x}function Dt(t){return t.y}function Cn(t){return t.z}var Hn=10,Ln=Math.PI*(3-Math.sqrt(5)),Pn=Math.PI*20/(9+Math.sqrt(221));function Qn(t,n){n=n||2;var i=Math.min(kt,Math.max(1,Math.round(n))),e,r=1,s=.001,o=1-Math.pow(s,1/300),a=0,f=.6,l=new Map,u=bt(x),c=dt("tick","end"),y=Bn();t==null&&(t=[]);function x(){_(),c.call("tick",e),r<s&&(u.stop(),c.call("end",e))}function _(h){var v,w=t.length,z;h===void 0&&(h=1);for(var g=0;g<h;++g)for(r+=(a-r)*o,l.forEach(function(d){d(r)}),v=0;v<w;++v)z=t[v],z.fx==null?z.x+=z.vx*=f:(z.x=z.fx,z.vx=0),i>1&&(z.fy==null?z.y+=z.vy*=f:(z.y=z.fy,z.vy=0)),i>2&&(z.fz==null?z.z+=z.vz*=f:(z.z=z.fz,z.vz=0));return e}function N(){for(var h=0,v=t.length,w;h<v;++h){if(w=t[h],w.index=h,w.fx!=null&&(w.x=w.fx),w.fy!=null&&(w.y=w.fy),w.fz!=null&&(w.z=w.fz),isNaN(w.x)||i>1&&isNaN(w.y)||i>2&&isNaN(w.z)){var z=Hn*(i>2?Math.cbrt(.5+h):i>1?Math.sqrt(.5+h):h),g=h*Ln,d=h*Pn;i===1?w.x=z:i===2?(w.x=z*Math.cos(g),w.y=z*Math.sin(g)):(w.x=z*Math.sin(g)*Math.cos(d),w.y=z*Math.cos(g),w.z=z*Math.sin(g)*Math.sin(d))}(isNaN(w.vx)||i>1&&isNaN(w.vy)||i>2&&isNaN(w.vz))&&(w.vx=0,i>1&&(w.vy=0),i>2&&(w.vz=0))}}function p(h){return h.initialize&&h.initialize(t,y,i),h}return N(),e={tick:_,restart:function(){return u.restart(x),e},stop:function(){return u.stop(),e},numDimensions:function(h){return arguments.length?(i=Math.min(kt,Math.max(1,Math.round(h))),l.forEach(p),e):i},nodes:function(h){return arguments.length?(t=h,N(),l.forEach(p),e):t},alpha:function(h){return arguments.length?(r=+h,e):r},alphaMin:function(h){return arguments.length?(s=+h,e):s},alphaDecay:function(h){return arguments.length?(o=+h,e):+o},alphaTarget:function(h){return arguments.length?(a=+h,e):a},velocityDecay:function(h){return arguments.length?(f=1-h,e):1-f},randomSource:function(h){return arguments.length?(y=h,l.forEach(p),e):y},force:function(h,v){return arguments.length>1?(v==null?l.delete(h):l.set(h,p(v)),e):l.get(h)},find:function(){var h=Array.prototype.slice.call(arguments),v=h.shift()||0,w=(i>1?h.shift():null)||0,z=(i>2?h.shift():null)||0,g=h.shift()||1/0,d=0,M=t.length,m,j,E,I,$,V;for(g*=g,d=0;d<M;++d)$=t[d],m=v-$.x,j=w-($.y||0),E=z-($.z||0),I=m*m+j*j+E*E,I<g&&(V=$,g=I);return V},on:function(h,v){return arguments.length>1?(c.on(h,v),e):c.on(h)}}}function Wn(){var t,n,i,e,r,s=b(-30),o,a=1,f=1/0,l=.81;function u(_){var N,p=t.length,h=(n===1?nt(t,ut):n===2?et(t,ut,Dt):n===3?st(t,ut,Dt,Cn):null).visitAfter(y);for(r=_,N=0;N<p;++N)i=t[N],h.visit(x)}function c(){if(t){var _,N=t.length,p;for(o=new Array(N),_=0;_<N;++_)p=t[_],o[p.index]=+s(p,_,t)}}function y(_){var N=0,p,h,v=0,w,z,g,d,M=_.length;if(M){for(w=z=g=d=0;d<M;++d)(p=_[d])&&(h=Math.abs(p.value))&&(N+=p.value,v+=h,w+=h*(p.x||0),z+=h*(p.y||0),g+=h*(p.z||0));N*=Math.sqrt(4/M),_.x=w/v,n>1&&(_.y=z/v),n>2&&(_.z=g/v)}else{p=_,p.x=p.data.x,n>1&&(p.y=p.data.y),n>2&&(p.z=p.data.z);do N+=o[p.data.index];while(p=p.next)}_.value=N}function x(_,N,p,h,v){if(!_.value)return!0;var w=[p,h,v][n-1],z=_.x-i.x,g=n>1?_.y-i.y:0,d=n>2?_.z-i.z:0,M=w-N,m=z*z+g*g+d*d;if(M*M/l<m)return m<f&&(z===0&&(z=T(e),m+=z*z),n>1&&g===0&&(g=T(e),m+=g*g),n>2&&d===0&&(d=T(e),m+=d*d),m<a&&(m=Math.sqrt(a*m)),i.vx+=z*_.value*r/m,n>1&&(i.vy+=g*_.value*r/m),n>2&&(i.vz+=d*_.value*r/m)),!0;if(_.length||m>=f)return;(_.data!==i||_.next)&&(z===0&&(z=T(e),m+=z*z),n>1&&g===0&&(g=T(e),m+=g*g),n>2&&d===0&&(d=T(e),m+=d*d),m<a&&(m=Math.sqrt(a*m)));do _.data!==i&&(M=o[_.data.index]*r/m,i.vx+=z*M,n>1&&(i.vy+=g*M),n>2&&(i.vz+=d*M));while(_=_.next)}return u.initialize=function(_,...N){t=_,e=N.find(p=>typeof p=="function")||Math.random,n=N.find(p=>[1,2,3].includes(p))||2,c()},u.strength=function(_){return arguments.length?(s=typeof _=="function"?_:b(+_),c(),u):s},u.distanceMin=function(_){return arguments.length?(a=_*_,u):Math.sqrt(a)},u.distanceMax=function(_){return arguments.length?(f=_*_,u):Math.sqrt(f)},u.theta=function(_){return arguments.length?(l=_*_,u):Math.sqrt(l)},u}function Gn(t){var n=b(.1),i,e,r;typeof t!="function"&&(t=b(t==null?0:+t));function s(a){for(var f=0,l=i.length,u;f<l;++f)u=i[f],u.vx+=(r[f]-u.x)*e[f]*a}function o(){if(i){var a,f=i.length;for(e=new Array(f),r=new Array(f),a=0;a<f;++a)e[a]=isNaN(r[a]=+t(i[a],a,i))?0:+n(i[a],a,i)}}return s.initialize=function(a){i=a,o()},s.strength=function(a){return arguments.length?(n=typeof a=="function"?a:b(+a),o(),s):n},s.x=function(a){return arguments.length?(t=typeof a=="function"?a:b(+a),o(),s):t},s}function Jn(t){var n=b(.1),i,e,r;typeof t!="function"&&(t=b(t==null?0:+t));function s(a){for(var f=0,l=i.length,u;f<l;++f)u=i[f],u.vy+=(r[f]-u.y)*e[f]*a}function o(){if(i){var a,f=i.length;for(e=new Array(f),r=new Array(f),a=0;a<f;++a)e[a]=isNaN(r[a]=+t(i[a],a,i))?0:+n(i[a],a,i)}}return s.initialize=function(a){i=a,o()},s.strength=function(a){return arguments.length?(n=typeof a=="function"?a:b(+a),o(),s):n},s.y=function(a){return arguments.length?(t=typeof a=="function"?a:b(+a),o(),s):t},s}function Kn(t){var n=b(.1),i,e,r;typeof t!="function"&&(t=b(t==null?0:+t));function s(a){for(var f=0,l=i.length,u;f<l;++f)u=i[f],u.vz+=(r[f]-u.z)*e[f]*a}function o(){if(i){var a,f=i.length;for(e=new Array(f),r=new Array(f),a=0;a<f;++a)e[a]=isNaN(r[a]=+t(i[a],a,i))?0:+n(i[a],a,i)}}return s.initialize=function(a){i=a,o()},s.strength=function(a){return arguments.length?(n=typeof a=="function"?a:b(+a),o(),s):n},s.z=function(a){return arguments.length?(t=typeof a=="function"?a:b(+a),o(),s):t},s}function lt(t){let n=2166136261;const i=String(t??"");for(let e=0;e<i.length;e+=1)n^=i.charCodeAt(e),n=Math.imul(n,16777619);return n>>>0}function ct(t,n){const i=lt(`${t}:a`)%360*Math.PI/180,e=(lt(`${t}:p`)%120-60)*Math.PI/180,r=n+lt(`${t}:r`)%24;return{x:Math.cos(i)*Math.cos(e)*r,y:Math.sin(e)*r*.72,z:Math.sin(i)*Math.cos(e)*r}}function _t(t,n){var s,o,a;const i={x:Number(((s=t.layout)==null?void 0:s.seedX)??0),y:Number(((o=t.layout)==null?void 0:o.seedY)??0),z:Number(((a=t.layout)==null?void 0:a.seedZ)??0)},e=t.anchorRef?n.get(t.anchorRef):null;if(t.kind==="entity"||!e)return i;if(t.kind==="commitment"){const f=ct(t.id,34);return{x:e.x+f.x*.6,y:e.y+48+f.y,z:e.z+30+f.z*.45}}if(t.kind==="pattern"){const f=ct(t.id,72);return{x:e.x+f.x,y:e.y+f.y*.7,z:e.z-56+f.z}}const r=ct(t.id,46);return{x:e.x+r.x*.75,y:e.y+18+r.y,z:e.z+r.z*.75}}function Un(t){return t.kind==="entity"?-180-Number(t.importance||0)*90:t.kind==="pattern"?-70:t.kind==="commitment"?-55:-26}function Vn(t){return Math.max(16,Number(t.size||5)*(t.kind==="entity"?3.2:2.4))}function ti(t={},n="entity"){return Number(n==="pattern"?t.pattern||1:n==="memory"?t.memory||1:t.entity||1)}function ni(t,n){const i=ti(n,t.lineFamily);return(t.channel==="trace"?54:t.channel==="relationship"?84-Math.min(Number(t.strength||0)*22,22):t.channel==="commitment"?40:34)*i}function ii(t){return t.channel==="trace"?.4:t.channel==="relationship"?.12+Number(t.strength||0)*.16:t.channel==="commitment"?.22:.16}function ei(t){const n={},i={};for(const e of t)n[e.id]={x:e.x||0,y:e.y||0,z:e.z||0},i[e.id]={x:e.vx||0,y:e.vy||0,z:e.vz||0};return{positions:n,velocities:i}}self.onmessage=t=>{const{type:n,jobId:i,nodes:e=[],edges:r=[],previousPositions:s={},motionLevel:o="full",lineLengths:a={}}=t.data||{};if(n!=="layout")return;const f=new Map(e.map(v=>{var w,z,g,d,M,m;return[v.id,{...v,x:Number(((w=s==null?void 0:s[v.id])==null?void 0:w.x)??((z=v.layout)==null?void 0:z.seedX)??0),y:Number(((g=s==null?void 0:s[v.id])==null?void 0:g.y)??((d=v.layout)==null?void 0:d.seedY)??0),z:Number(((M=s==null?void 0:s[v.id])==null?void 0:M.z)??((m=v.layout)==null?void 0:m.seedZ)??0)}]})),l=[...f.values()],u=r.filter(v=>f.has(v.source)&&f.has(v.target)).map(v=>({...v})),c=e.filter(v=>s==null?void 0:s[v.id]).length,y=e.length?c/e.length:0,x=y>.7?o==="reduced"?18:o==="restrained"?24:30:o==="reduced"?90:o==="restrained"?120:160,_=e.length>900?.48:e.length>500?.62:e.length>260?.82:1,N=Math.max(16,Math.round(x*_)),p=y>.7?.018:o==="reduced"?.09:.05,h=Qn(l,3).alpha(y>.7?.22:1).alphaDecay(y>.7?.14:o==="full"?.038:.05).velocityDecay(o==="full"?.22:.3).force("charge",Wn().strength(Un).distanceMax(520)).force("collide",kn().radius(Vn).strength(.85)).force("link",Fn(u).id(v=>v.id).distance(v=>ni(v,a)).strength(ii)).force("homeX",Gn(v=>_t(v,f).x).strength(p)).force("homeY",Jn(v=>_t(v,f).y).strength(p)).force("homeZ",Kn(v=>_t(v,f).z).strength(p));for(let v=0;v<N;v+=1)if(h.tick(),v===0||v%10===0||v===N-1){const w=ei(l);self.postMessage({type:"snapshot",jobId:i,positions:w.positions,velocities:w.velocities,done:v===N-1})}h.stop()}})();
//# sourceMappingURL=layoutWorker-Dh5J6AjO.js.map
